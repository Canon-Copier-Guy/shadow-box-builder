<!DOCTYPE html>
<html lang="en">
<head>
    <link href='https://fonts.googleapis.com/css?family=Ubuntu Mono' rel='stylesheet'>
    <!-- <link href="https://fonts.cdnfonts.com/css/race1-brannt-chiseled-ncv" rel="stylesheet"> -->
    <meta charset="UTF-8">
    <title>HAC Shadowbox Creator</title>
    <link rel="icon" href="https://cdn-longterm.mee6.xyz/plugins/embeds/images/1309714539331325952/55854afc13258498d8efa95fdad3a0e3b54052772ab4a4a9917ee8f426d03717.png">
    <style>
        body {
            font-family: Ubuntu Mono;
            text-align: center;
            padding: 10px;
        }

        .displayBox {
            position: relative;
            margin: auto;
        }
    </style>
</head>
<body onresize="resizeDisplayBox()">
    <Div id="theDiv">
    <h1>Start Making your Shadow Box!</h1>
    <select id="backgroundDropdown" onchange="updateBackground()">
        <option value="">-- Select Detachment --</option>
        <option value="/Shadowbox Templates/Shadow Box Template, HAC.png">Hazard Company</option>
        <option value="/Shadowbox Templates/Shadow Box Template, DR.png">Dread Reapers</option>
        <option value="/Shadowbox Templates/Shadow Box Template, DC.png">Death Company</option>
        <option value="/Shadowbox Templates/Shadow Box Template, PV.png">Phantom Vanguard</option>
    </select>

    <select id="rankDropdown" onchange="updateBackground()">
        <option value="">-- Select Rank --</option>
        <option value="1">Cadet</option>
        <option value="2">Space Cadet</option>
        <option value="3">Sergeant</option>
        <option value="4">Master Sergeant</option>
        <option value="5">Chief</option>
        <option value="6">Space Chief Prime</option>
        <option value="7">Death Captain	</option>
        <option value="8">Marshal</option>
        <option value="9">Star Marshal</option>
        <option value="10">Admiral</option>
        <option value="11">Skull Admiral</option>
        <option value="12">Fleet Admiral</option>
        <option value="13">Admirable Admiral</option>
        <option value="14">Commander</option>
        <option value="15">Galactic Commander</option>
        <option value="16">Hell Commander</option>
        <option value="17">General</option>
        <option value="18">5-Star General</option>
        <option value="19">10-Star General</option>
        <option value="20">Private</option>
        <option value="21">Super Private</option>
    </select>

    <select multiple id="ribbonsDropdown" onchange="updateBackground()">
        <option value="">-- Select Ribbon(s) --</option>
        <option value="https://drive.google.com/thumbnail?id=11ky11IsKxHttkMqMPdb7BahsFvc0UfyI&sz=w1000">Offensive Crusades</option>
        <option value="https://drive.google.com/thumbnail?id=1SolWu4KTG9GJDD7dWiB4lql-luyRZd-J&sz=w1000">Defensive Crusade</option>
        <option value="https://drive.google.com/thumbnail?id=1zzRpddSC0jAC8likai_peilo1r7TZBBD&sz=w1000">Outstanding Unit</option>
        <option value="https://drive.google.com/thumbnail?id=18n9wE16Nc-KyZNTwCVqW-XjX80TTqPnr&sz=w1000">Choohe Crusade</option>
        <option value="https://drive.google.com/thumbnail?id=1q4bicgFAxe-1j5I3obzfmZe2NuYZE7QE&sz=w1000">Genesis Crusade</option>
        <option value="https://drive.google.com/thumbnail?id=1vYvj0Gtts7dfXizYcmPBKlIzb8y98m_x&sz=w1000">Jungle Hero Strike</option>
        <option value="https://drive.google.com/thumbnail?id=15SEMhYvPXze6_V0u-5xI55MPP3NgRWlI&sz=w1000">Silent Bastion Strike</option>
        <option value="https://drive.google.com/thumbnail?id=1A8Mh75_KIhhaysc9bfVUHApBtWP3F9_7&sz=w1000">Gloom Crusade</option>
        <option value="https://drive.google.com/thumbnail?id=1qszcuMSDZku8OFvXtFDuz-2ZaO3gmL9U&sz=w1000">Blitzdiver Event</option>
        <option value="https://drive.google.com/thumbnail?id=1veO9ffVU_1S0YWcwrIyUPX0rYpkyg8ru&sz=w1000">Dio's Duck Divers </option>
        <option value="https://drive.google.com/thumbnail?id=1kcNSfhuZWIGH0a09SnLZT0oWiuy-7kQn&sz=w1000">Sporeburn Strike</option>
        <option value="https://drive.google.com/thumbnail?id=18eWC4BQrqgylIjIgGLfzRpw6Us1ohoKh&sz=w1000">General Brasch</option>
        <option value="https://drive.google.com/thumbnail?id=1I4aOtSDdIxO5Z5wqTvWdmxT1-zFeuGrW&sz=w1000">John Helldiver</option>
        <option value="https://drive.google.com/thumbnail?id=11K8TM_sqXmh5HpwwQ-rfs3bj0uRshLp9&sz=w1000">Medic</option>
        <option value="https://drive.google.com/thumbnail?id=1EwJUehneS81-2M_E-2bsYk99LhETi-wo&sz=w1000">Melee Proficiency</option>
        <option value="https://drive.google.com/thumbnail?id=14aoY6brfDPJeIm5rNhmFs4ETpt7KExU9&sz=w1000">Shots Fired</option>
        <option value="https://drive.google.com/thumbnail?id=19qAuoXcBR-yFrQo7nl9CTm37e9btXzAx&sz=w1000">Speedruns</option>
        <option value="https://drive.google.com/thumbnail?id=1Z_PTKqhm_KhGTBPKp3gXWtWh9RBudnOg&sz=w1000">Recruitment</option>
        <option value="https://drive.google.com/thumbnail?id=1isttZluvJshq1uYNy-x6AhKAJl2uNFRq&sz=w1000">Ghost Ribbon</option>
        <option value="https://drive.google.com/thumbnail?id=1O9zbxW-bWFS5qcNHaHvGW8tZq0wU3Ode&sz=w1000">Soaring Freedom</option>
        <option value="https://drive.google.com/thumbnail?id=1UISfCJIYihKETBg62hT_kipqDuIittw7&sz=w1000">Angel of Death</option>
        <option value="https://drive.google.com/thumbnail?id=19ky8jGRMqzn5GGf7xH7azCo0KyoAbxA7&sz=w1000">Retirment</option>
        <option value="https://drive.google.com/thumbnail?id=1EdMEerbQKz2TUdPt0k6GMGWkhWfAVcCo&sz=w1000">Stratagem Hero</option>
        <option value="https://drive.google.com/thumbnail?id=1dtIebf1TCdn_HOlqMasxuMPiwdnG5FF4&sz=w1000">Terminid Career Kills</option>
        <option value="https://drive.google.com/thumbnail?id=17i7bq4-FgbhGi1fu5OaXohbchSBNHO1z&sz=w1000">Terminid Kill Record</option>
        <option value="https://drive.google.com/thumbnail?id=1SuJ39whXa5k-XWaukqtJhAA9xkC15TDE&sz=w1000">Automaton Career Kills</option>
        <option value="https://drive.google.com/thumbnail?id=1Wc73phKca4meLg7YmnS8Qu0AvpOOci3L&sz=w1000">Automation Kill Record</option>
        <option value="https://drive.google.com/thumbnail?id=1JShh-WbgYHoRMWAI1nxtlBIm95q1Wmb-&sz=w1000">Illuminate Career Kills</option>
        <option value="https://drive.google.com/thumbnail?id=10xT1d9Pbx7_QyRoBb22e_7JmVg6rkvBc&sz=w1000">Illuminate Kill Record</option>
        <option value="https://drive.google.com/thumbnail?id=1J0zrMPSiSGfueYJQxSpGHUy2rc0is44H&sz=w1000">Grenade Kills</option>
        <option value="https://drive.google.com/thumbnail?id=1Nn15CDcJTrRZ1k9UIXJ6So-QszveMf1Y&sz=w1000">Melee Kills</option>
        <option value="https://drive.google.com/thumbnail?id=14GjOfICJLr2rykK6aMPXv85ys4bTIj4m&sz=w1000">Eagle Kills</option>
        <!-- Extractions would go here (when it's ready)-->
        <option value="https://drive.google.com/thumbnail?id=19xkp1a91N60uPqHZXe1QIZ8ykrGs2UBA&sz=w1000">Objectives</option>
        <option value="https://drive.google.com/thumbnail?id=1wSdicSURRkzxsM4qmZfwAbOd4q7Addp5&sz=w1000">Missions</option>
        <option value="https://drive.google.com/thumbnail?id=1qAvUyf3DZdUi0ILfEuv3hoaWO7ZQdCX4&sz=w1000">Samples</option>
        <option value="https://drive.google.com/thumbnail?id=134EAuzMShoT-UIKNmrhyQ7_48B4zfBEN&sz=w1000">lvl 150 1x</option>
        <option value="https://drive.google.com/thumbnail?id=1bsxrhqiQjOE2N-4uvW7StierxDEuOijA&sz=w1000">lvl 150 2x</option>
        <option value="https://drive.google.com/thumbnail?id=1v_fugy8ldUrZl0vTMYSopL_4TVTG6GlU&sz=w1000">lvl 150 3x</option>
        <option value="https://drive.google.com/thumbnail?id=116Vh8DrWtABEvzwfwJTHP0uGqhSWIFzs&sz=w1000">lvl 150 4x</option>
        <option value="https://drive.google.com/thumbnail?id=18JdjMxepgGQULNv1jDVs5IJA0I-JyCwM&sz=w1000">lvl 150 5x</option>
    </select>

    <select multiple id="MedalsDropdown" onchange="updateBackground()">
        <option value="">-- Select Medals(s) --</option>
        <option value="1">Terminid Blitz</option>
        <option value="2">Offensive Offensive</option>
        <option value="3">Defensive Crusade</option>
        <option value="4">Choohe Crusade</option>
        <option value="5">Genesis Crusade</option>
        <option value="6">Gloom Crusade</option>
    </select>

    <input id="numberCallsign" type="text" placeholder="Insert number and Callsign" onchange="updateBackground()">

    <input id="downloadButton" type="button" value="Download Shadow Box" onclick="downloadShadowBox();" />

    <br></br>

    </div>

    <canvas class="displayBox" id="displayBox"></canvas>

    <canvas id="fullBox" hidden></canvas>

    <script>
        var scale = 0;

        if ((window.innerHeight-document.getElementById("theDiv").offsetHeight-60) > (window.innerWidth-40)*2796/2236) {
            scale = ((window.innerWidth-40)/2236);
        }
        if ((window.innerHeight-document.getElementById("theDiv").offsetHeight-60) <= (window.innerWidth-40)*2796/2236) { 
            scale = ((window.innerHeight-document.getElementById("theDiv").offsetHeight-60)/2796);
        }

        //const scale = 0.5;
        var selectedRank;
        var selectedRankIconWidth;
        var selectedRankIconHeight;
        var selectedMedalWidth;
        var selectedMedalHeight;
        var selectedBackground;
        var detachment = "";

        var name = "";
        var textWidth;
        var textHeight;

        document.getElementById('displayBox').style.width = 2236*scale;
        document.getElementById('displayBox').style.height = 2796*scale;

        document.getElementById('displayBox').width = 2236*scale;
        document.getElementById('displayBox').height = 2796*scale;

        document.getElementById('fullBox').width = 2236;
        document.getElementById('fullBox').height = 2796;

        function updateBackground() {
            let dropdown = document.getElementById('backgroundDropdown');
            let background = document.getElementById('selectedBackground');

            selectedBackground = new Image();
            selectedBackground.src = dropdown.value;

            if (dropdown.value == "/Shadowbox Templates/Shadow Box Template, HAC.png") {
                detachment = "HAC-";
            }
            else if (dropdown.value == "/Shadowbox Templates/Shadow Box Template, DR.png") {
                detachment = "DR-";
            }
            else if (dropdown.value == "/Shadowbox Templates/Shadow Box Template, DC.png") {
                detachment = "DC-";
            }
            else if (dropdown.value == "/Shadowbox Templates/Shadow Box Template, PV.png") {
                detachment = "PV-";
            }

            // Wait till image is loaded.
            selectedBackground.onload = function () {
                let canvas = document.getElementById('displayBox');
                let ctx = canvas.getContext('2d');

                //Draw background
                ctx.drawImage(selectedBackground, 0, 0, selectedBackground.width, selectedBackground.height, 0, 0, 2236*scale, 2796*scale);

                // Get context for full resolution canvas and draw it
                canvas = document.getElementById('fullBox');
                ctx = canvas.getContext('2d');

                //Draw background
                ctx.drawImage(selectedBackground, 0, 0, selectedBackground.width, selectedBackground.height, 0, 0, 2236*scale, 2796*scale);
                
                updateRank();
                updateName();
                updateRibbons();
                updateMedals();
            }
        }
        function updateRank() {
            const dropdown = document.getElementById('rankDropdown');
            const rank = document.getElementById('selectedRank');

            const ranks = {
                "1":  "/Ranks/0_Cadet.png", // Cadet
                "2":  "/Ranks/5_Space Cadet.png", // Space Cadet
                "3":  "/Ranks/10_Sergeant.png", // Sergeant
                "4":  "/Ranks/15_Master Sergeant.png", // Master Sergeant
                "5":  "/Ranks/20_Chief.png", // Chief
                "6":  "/Ranks/25_Space Chief Prime.png", // Space Chief Prime
                "7":  "/Ranks/30_Death Captain.png", // Death Captain
                "8":  "/Ranks/35_Marshal.png", // Marshal
                "9":  "/Ranks/40_Star Marshal.png", // Star Marshal
                "10": "/Ranks/45_Admiral.png", // Admiral
                "11": "/Ranks/50_Skull Admiral.png", // Skull Admiral
                "12": "/Ranks/60_Fleet Admiral.png", // Fleet Admiral
                "13": "/Ranks/70_Admirable_Admiral", // Admirable Admiral
                "14": "/Ranks/80_Commander.png", // Commander
                "15": "/Ranks/90_Galactic Commander.png", // Galactic Commander
                "16": "/Ranks/100_Hell Commander.png", // Hell Commander
                "17": "/Ranks/110_General.png", // General
                "18": "/Ranks/120_5-Star General.png", // 5-Star General
                "19": "/Ranks/130_10-Star General.png", // 10-Star General
                "20": "/Ranks/140_Private.png", // Private
                "21": "/Ranks/150_Super Private.png"  // Super Private
            };

            rankIconWidths = {
                "1":  154, // Cadet
                "2":  154, // Space Cadet
                "3":  154, // Sergeant
                "4":  154, // Master Sergeant
                "5":  154, // Chief
                "6":  154, // Space Chief Prime
                "7":  154, // Death Captain
                "8":  154, // Marshal
                "9":  154, // Star Marshal
                "10": 154, // Admiral
                "11": 154, // Skull Admiral
                "12": 154, // Fleet Admiral
                "13": 185, // Admirable Admiral (177 for realz, don't have actial icon)
                "14": 154, // Commander
                "15": 177, // Galactic Commander
                "16": 154, // Hell Commander
                "17": 154, // General
                "18": 154, // 5-Star General
                "19": 177, // 10-Star General
                "20": 154, // Private
                "21": 177  // Super Private
            };

            rankIconHeights = {
                "1":  180, // Cadet
                "2":  180, // Space Cadet
                "3":  180, // Sergeant
                "4":  180, // Master Sergeant
                "5":  176, // Chief
                "6":  176, // Space Chief Prime
                "7":  176, // Death Captain
                "8":  203, // Marshal
                "9":  203, // Star Marshal
                "10": 203, // Admiral
                "11": 203, // Skull Admiral
                "12": 205, // Fleet Admiral
                "13": 205, // Admirable Admiral
                "14": 206, // Commander
                "15": 206, // Galactic Commander
                "16": 202, // Hell Commander
                "17": 202, // General
                "18": 205, // 5-Star General
                "19": 205, // 10-Star General
                "20": 177, // Private
                "21": 202  // Super Private
            };

            selectedRankIconWidth = rankIconWidths[dropdown.value];
            selectedRankIconHeight = rankIconHeights[dropdown.value];

            selectedRank = new Image();
            selectedRank.src = ranks[dropdown.value];

            // Wait till image is loaded.
            selectedRank.onload = function () {
                let canvas = document.getElementById('displayBox');
                let ctx = canvas.getContext('2d');

                //Draw rank icon
                ctx.drawImage(selectedRank, 0, 0, selectedRank.width, selectedRank.height, (2123-(selectedRankIconWidth/2))*scale, (239-selectedRankIconHeight)*scale, selectedRankIconWidth*scale, selectedRankIconHeight*scale);
            
                // Get context for full resolution canvas and draw it
                canvas = document.getElementById('fullBox');
                ctx = canvas.getContext('2d');

                ctx.drawImage(selectedRank, 0, 0, selectedRank.width, selectedRank.height, (2123-(selectedRankIconWidth/2)), (239-selectedRankIconHeight), selectedRankIconWidth, selectedRankIconHeight);
            }
        }
        function updateName() {
            let canvas = document.getElementById('displayBox');
            let ctx = canvas.getContext('2d');
            name = (detachment+document.getElementById('numberCallsign').value.toUpperCase());
            let nameLength = name.length;

            // Measure the width of the text
            /*textHeight = 130*scale;
            ctx.font = (textHeight+'px Ubuntu Mono');
            textWidth = ctx.measureText(name).width;*/

            textHeight = Math.round(130*scale);
            ctx.font = (textHeight+'px Ubuntu Mono');
            ctx.fillStyle = "gold";
            //ctx.shadowColor = "black";
            //ctx.shadowOffsetX = 5;
            //ctx.shadowOffsetY = 5;
            //ctx.shadowBlur = 10;
            textWidth = ctx.measureText(name).width;

            // Calculate the height of the text based on font size and line height

            if (textWidth >= 642*scale) {
                textHeight = Math.round(((642*scale)/nameLength)*2);
                ctx.font = (textHeight+'px Ubuntu Mono');
                textWidth = 642*scale;
            }
            else {
                ctx.font = (textHeight+'px Ubuntu Mono');
                textWidth = ctx.measureText(name).width;
            }

            console.log(scale);
            console.log(textHeight);
            console.log(textWidth);

            //Draw text
            ctx.fillText(name, (1118*scale)-textWidth/2, (557*scale)+textHeight/4);
        }
        function updateMedals() {
            let selectedMedel = document.getElementById('MedalsDropdown');
            //let medal = document.getElementById('selectedMedals');

            let medals = {
                //Strike & Crusade Ribbons
                "1": "https://drive.google.com/thumbnail?id=1FpylY_tA7L6_rOvEnRlHUQu8VARUUVEj&sz=w1000", //Terminid Blitz
                "2": "https://drive.google.com/thumbnail?id=1r2th-Es94lUIfVnYoUfn30JKf-c8skoK&sz=w1000", //Offensive Crusade
                "3": "https://drive.google.com/thumbnail?id=1zl4bXJj6V85CRgxmKgRWQfecuDFAtjHE&sz=w1000", //Defensive Crusade
                "4": "https://drive.google.com/thumbnail?id=1atERb9LW6OTf2iEWD5JOCXCzFiZiwI7K&sz=w1000", //Choohe Crusade
                "5": "https://drive.google.com/thumbnail?id=17zqikpOBZNZLe0-edqf7D5rn3qqaUljp&sz=w1000", //Genesis Crusade
                "6": "https://drive.google.com/thumbnail?id=1Hn087FXvTY3cjP0MzUlrBXKUr2y_edyq&sz=w1000"  //Gloom Crusade
            };

            medalWidths = {
                "1":  370, //Terminid Blitz
                "2":  323, //Offensive Crusade
                "3":  323, //Defensive Crusade
                "4":  341, //Choohe Crusade
                "5":  320, //Genesis Crusade
                "6":  325, //Gloom Crusade
            };

            medalHeights = {
                "1":  512, //Terminid Blitz
                "2":  512, //Offensive Crusade
                "3":  512, //Defensive Crusade
                "4":  512, //Choohe Crusade
                "5":  512, //Genesis Crusade
                "6":  512, //Gloom Crusade
            };

            let medal = new Image();
            medal.src = medals[selectedMedel.value];

            selectedMedalWidth = medalWidths[selectedMedel.value];
            selectedMedalHeight = medalHeights[selectedMedel.value];

            // Wait till image is loaded.
            medal.onload = function () {
                // Get Context for canvas to display to the user and draw it
                let canvas = document.getElementById('displayBox');
                let ctx = canvas.getContext('2d');

                //Draw medal
                ctx.drawImage(medal, 0, 0, medal.width, medal.height, (215-(selectedMedalWidth/2))*scale, 775*scale, selectedMedalWidth*scale, 512*scale);

                // Get context for full resolution canvas and draw it
                canvas = document.getElementById('fullBox');
                ctx = canvas.getContext('2d');

                //Draw medal
                ctx.drawImage(medal, 0, 0, medal.width, medal.height, (215-(selectedMedalWidth/2)), 775, selectedMedalWidth, 512);
            }

            console.log(document.getElementById('medalsDropdown').selectedOptions.length);
        }
        function updateRibbons() {
            let dropdown = document.getElementById('ribbonsDropdown');
            let ribbons = document.getElementById('selectedRibbons');

            let ribbon = new Image();
            ribbon.src = dropdown.value;

            // Wait till image is loaded.
            ribbon.onload = function () {
                // Get Context for canvas to display to the user and draw it
                let canvas = document.getElementById('displayBox');
                let ctx = canvas.getContext('2d');

                //Draw ribbon
                ctx.drawImage(ribbon, 0, 0, ribbon.width, ribbon.height, 1118*scale, 775*scale, 312*scale, 75*scale);

                // Get context for full resolution canvas and draw it
                canvas = document.getElementById('fullBox');
                ctx = canvas.getContext('2d');

                //Draw ribbon
                ctx.drawImage(ribbon, 0, 0, ribbon.width, ribbon.height, 1118, 775, 312, 75);
            }
            console.log(document.getElementById('ribbonsDropdown').selectedOptions.length);
        }
        function downloadShadowBox() {
            let canvas = document.getElementById("fullBox");
            let dataURL = canvas.toDataURL("image/png");
            let a = document.createElement('a');
            a.href = dataURL;
            a.download = 'canvas-download.png';
            a.click();
        }
        function resizeDisplayBox() {
            let currentScale = scale;

            if ((window.innerHeight-document.getElementById("theDiv").offsetHeight-60) > (window.innerWidth-40)*2796/2236) {
                scale = ((window.innerWidth-40)/2236);
            }
            if ((window.innerHeight-document.getElementById("theDiv").offsetHeight-60) <= (window.innerWidth-40)*2796/2236) { 
                scale = ((window.innerHeight-document.getElementById("theDiv").offsetHeight-60)/2796);
            }

            let newScale = scale;

            //drawImage(img, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)
            if (currentScale != newScale) {
                let canvas = document.getElementById('displayBox');
                let ctx = canvas.getContext('2d');

                //document.getElementById('displayBox').style.width = 2236*scale;
                //document.getElementById('displayBox').style.height = 2796*scale;

                document.getElementById('displayBox').width = 2236*scale;
                document.getElementById('displayBox').height = 2796*scale;

                updateBackground();
            }
        }
    </script>
</body>
</html>
